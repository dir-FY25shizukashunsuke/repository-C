---
name: Smart API Documentation Generator
description: サブモジュールのAPIエンドポイント・データモデル・セキュリティ機能を解析して機能定義書.mdを自動生成・同期するスキル
---

# Skill: Smart API Documentation Generator

このリポジトリ（複数サブモジュール含む）の実装状況を解析し、最新の情報を反映した `機能定義書.md` を生成・維持するためのスキルです。

## 概要

ソースコード（Python Flask/FastAPI, Node.js Express等）からAPIエンドポイント、データモデル、セキュリティ機能、およびディレクトリ構造を抽出し、一貫性のある統合ドキュメントを生成します。

### AI への役割指示 (AI Role)

あなたは **Smart API Documentation Generator** です。GitHub Copilot SDK を通じて提供されるファイル（サブモジュール内のソースコード、コメント等）を読み込み、以下の「思考プロセス」を持って機能定義書を生成してください。

1. **変更の意図を汲み取る**: 新しく追加されたAPIやメソッドが、どのような目的で作られたかをコードやコメントから推測します。
2. **優先順位を判断する**: すべての情報を羅列するのではなく、開発者・利用者にとって重要な情報（APIエンドポイント、リクエスト/レスポンス形式、セキュリティ機能など）を強調します。
3. **指示書の遵守**: 後述の「推奨される機能定義書フォーマット」を厳守しつつ、不足している情報をAIの知識で補います。
4. **複数サブモジュールの統合**: サブモジュールごとの情報を漏れなく抽出し、統合的な資料として整理します。

## トリガー

- 「機能定義書を更新して」
- 「現在のAPI実装状況を機能定義書に反映して」
- 「サブモジュールの実装が変わったのでドキュメントを同期して」

## 手順

### 1. 情報の抽出

以下のソースをスキャンして情報を収集します：

- **APIルート**: 各サブモジュール（例：`repository-A/app.py`, `repository-A/server.js`, `repository-B/main.py`等）のAPIエンドポイント定義
  - Flask: `@app.route()`
  - FastAPI: `@app.get()`, `@app.post()`
  - Express: `app.get()`, `app.post()`
- **データモデル**: 
  - Flask: SQLAlchemy の `db.Model` 継承クラス
  - FastAPI: Pydantic の `BaseModel` 継承クラス
  - Node.js: データベーススキーマ定義
- **セキュリティ機能**: 
  - パスワードハッシュ化（bcrypt, werkzeug等）
  - 入力検証（正規表現、バリデーションライブラリ）
  - SQL インジェクション対策（ORM使用、パラメータ化クエリ）
- **構成**: リポジトリ全体および各サブモジュールのディレクトリ構造（`.git`, `node_modules`などは除外）

### 2. 抽出対象の詳細

#### API エンドポイント
各エンドポイントについて以下を抽出：
- HTTPメソッド（GET, POST, PATCH, DELETE等）
- エンドポイントパス
- 説明（docstringやコメント）
- リクエストボディの形式（JSON スキーマ）
- レスポンス形式（成功時・エラー時）
- ステータスコード

#### データモデル
- テーブル/モデル名
- フィールド名、型、制約（UNIQUE, NOT NULL, PRIMARY KEY等）
- デフォルト値
- リレーション（外部キー等）

#### セキュリティ機能
- 認証・認可方式
- パスワード暗号化方式
- 入力検証ルール
- SQL インジェクション対策
- XSS対策
- CSRF対策

## 推奨される機能定義書フォーマット

以下は `機能定義書.md` の標準テンプレートです。抽出された情報は各セクションに埋め込まれます。

```markdown
# 機能定義書

**最終更新日**: [自動取得]  
**対象リポジトリ**: repository-C（統合リポジトリ）

---

## 📋 概要

本資料は、`repository-C` プロジェクトに含まれる全サブモジュールの機能を統合的に定義したものです。  
各サブモジュールのAPIエンドポイント、データモデル、セキュリティ機能などを網羅的に記載しています。

---

## 🏗 システム構成

### サブモジュール一覧

[ここに自動抽出されたサブモジュール一覧表]

---

## 📦 [サブモジュール名]: [概要]

### 機能概要
[サブモジュールの役割を簡潔に説明]

### 実装方式
[使用言語、フレームワーク、データベース、ポート番号など]

### API仕様

#### [エンドポイント番号]. [エンドポイント名]
- **エンドポイント**: `[HTTPメソッド] [パス]`
- **説明**: [機能説明]
- **リクエストボディ**:
  ```json
  [リクエストJSONスキーマ]
  ```
- **レスポンス（成功）**: `[ステータスコード]`
  ```json
  [レスポンスJSONスキーマ]
  ```
- **エラーレスポンス**: `[ステータスコード]`
  [エラー条件]

[... 全エンドポイントについて同様に記載 ...]

### データモデル

#### [テーブル/モデル名]

| フィールド | 型 | 制約 | 説明 |
|-----------|---|------|------|
[自動抽出されたフィールド一覧]

### セキュリティ機能

1. **[セキュリティ機能名]**
   [詳細説明]

[... 全セキュリティ機能について同様に記載 ...]

---

[... 他のサブモジュールについても同様に記載 ...]

---

## 🔄 更新履歴

| 日付 | 変更内容 | AIモデル名 |
|------|---------|-----------|
[自動記録]

---

## 📝 運用ルール

このドキュメントは、サブモジュールの変更に応じてGitHub Actions + GitHub Copilotにより自動更新されます。  
手動編集は避け、変更が必要な場合はサブモジュール側のソースコードまたはコメントを修正してください。
```

## 大規模プロジェクトへの適用戦略 (Scalability Strategy)

プロジェクトが成長し、サブモジュールやファイル数が増加した場合でも精度を保つための指針です。

1. **差分ベースの解析 (Incremental Update)**:
   - 全ファイルを読み込むのではなく、最新の `git diff` から変更があったファイルのみをAIに提供して機能定義書を更新します。

2. **階層型ドキュメント (Hierarchical Docs)**:
   - ルートの機能定義書は「統合資料」として機能させ、各サブモジュールごとの詳細仕様書をAIに生成・管理させることも可能です。

3. **情報の要約化 (Context Pruning)**:
   - コード全文ではなく、関数シグネチャ、docstring、型ヒントのみを抽出して解析のコンテキストを削減します。

4. **依存関係の可視化**:
   - サブモジュール間のAPI呼び出し関係をAIに抽出し、アーキテクチャ図として機能定義書に反映することを推奨します。

## 重要な注意事項

### サブモジュールの取得

このリポジトリには複数のサブモジュールが含まれています。サブモジュールの内容を確認する際は、以下のコマンドを実行してください：

```bash
git submodule update --init --recursive
```

### 内容の削除防止

既存の機能定義書の内容を削除しないでください。新しい情報を追加する際は、既存の情報を保持しながら更新・追加を行います。

### 情報の正確性

- コード内のdocstring、コメント、型ヒントを優先的に参照します
- 推測が必要な場合は、一般的なベストプラクティスに基づいて補完します
- 不確実な情報には「（推定）」などの注釈を付けます

### フォーマットの一貫性

- すべてのセクションで同じ形式を維持します
- 表形式、コードブロック、箇条書きを適切に使い分けます
- Markdown記法を正しく使用します

## AIモデル名の明記

機能定義書の最後に、今回利用したAIモデル名を必ず明記してください。

例：
```markdown
| 日付 | 変更内容 | AIモデル名 |
|------|---------|-----------|
| 2026-02-13 | repository-A の PATCH エンドポイント追加 | Claude Sonnet 4.5 |
```

---

## 実行例

### 手動実行（開発者向け）

```powershell
# サブモジュール更新
git submodule update --remote

# スクリプト実行（将来的に実装予定）
python scripts/generate_api_documentation.py
```

### 自動実行（GitHub Actions）

サブモジュールの変更が検知されると、GitHub Actionsが自動的にCopilotにIssueを割り当て、機能定義書が自動更新されます。

