# 機能定義書

**最終更新日**: 2026年2月13日  
**対象リポジトリ**: repository-C（統合リポジトリ）

---

## 📋 概要

本資料は、`repository-C` プロジェクトに含まれる全サブモジュールの機能を統合的に定義したものです。  
各サブモジュールのAPIエンドポイント、データモデル、セキュリティ機能などを網羅的に記載しています。

---

## 🏗 システム構成

### サブモジュール一覧

| サブモジュール | 概要 | 主要技術 | 備考 |
|--------------|------|---------|------|
| **repository-A** | ユーザー登録API | Flask (Python) / Express (Node.js) | 2つの実装を提供 |
| **repository-B** | 文字列・数値処理API | FastAPI (Python) | シンプルなユーティリティAPI |

---

## 📦 repository-A: ユーザー登録API

### 機能概要
ユーザーの登録・更新機能を提供するAPIサーバー。Flask実装とNode.js実装の2種類が用意されています。

### 実装方式

#### Flask実装（app.py）
- **言語**: Python 3.x
- **フレームワーク**: Flask 3.1.0
- **ORM**: SQLAlchemy 2.0.36
- **データベース**: SQLite (`users.db`)
- **ポート**: 5000

#### Node.js実装（server.js + db.js）
- **言語**: Node.js
- **フレームワーク**: Express.js 4.21.2
- **データベース**: SQLite (`users.db`)
- **パスワードハッシュ化**: bcryptjs 2.4.3
- **ポート**: 3000

### API仕様

#### 1. ホームエンドポイント
- **エンドポイント**: `GET /`
- **説明**: API動作確認用
- **リクエスト**: なし
- **レスポンス**:
  ```json
  {
    "message": "ユーザー登録API へようこそ！"
  }
  ```

#### 2. ユーザー登録
- **エンドポイント**: `POST /api/users/register`
- **説明**: 新規ユーザーを登録
- **リクエストボディ**:
  ```json
  {
    "username": "string (必須)",
    "email": "string (必須、正規表現検証)",
    "password": "string (必須、6文字以上)",
    "passwordConfirm": "string (必須、passwordと一致)"
  }
  ```
- **レスポンス（成功）**: `201 Created`
  ```json
  {
    "message": "ユーザー登録が完了しました",
    "user": {
      "id": 1,
      "username": "testuser",
      "email": "test@example.com",
      "created_at": "2026-02-13T10:00:00"
    }
  }
  ```
- **エラーレスポンス**: `400 Bad Request`
  - パスワード不一致
  - メールアドレス形式不正
  - ユーザー名・メール重複
  - 必須項目不足

#### 3. ユーザー一覧取得
- **エンドポイント**: `GET /api/users`
- **説明**: 登録されている全ユーザーの一覧を取得
- **リクエスト**: なし
- **レスポンス（成功）**: `200 OK`
  ```json
  {
    "users": [
      {
        "id": 1,
        "username": "testuser",
        "email": "test@example.com",
        "created_at": "2026-02-13T10:00:00"
      }
    ]
  }
  ```

#### 4. ユーザー情報更新
- **エンドポイント**: `PATCH /api/users/<user_id>`
- **説明**: 既存ユーザーのユーザー名・メールアドレスを更新
- **リクエストボディ**:
  ```json
  {
    "username": "string (任意)",
    "email": "string (任意)"
  }
  ```
- **レスポンス（成功）**: `200 OK`
  ```json
  {
    "message": "ユーザー情報を更新しました",
    "user": {
      "id": 1,
      "username": "updateduser",
      "email": "updated@example.com",
      "created_at": "2026-02-13T10:00:00"
    }
  }
  ```
- **エラーレスポンス**: `404 Not Found`

### データモデル

#### Userテーブル

| フィールド | 型 | 制約 | 説明 |
|-----------|---|------|------|
| `id` | Integer | PRIMARY KEY, AUTO INCREMENT | ユーザーID |
| `username` | String(80) | UNIQUE, NOT NULL | ユーザー名 |
| `email` | String(120) | UNIQUE, NOT NULL | メールアドレス |
| `password` | String(255) | NOT NULL | ハッシュ化されたパスワード |
| `created_at` | DateTime | DEFAULT NOW | 登録日時 |

### セキュリティ機能

1. **パスワードハッシュ化**
   - Flask: `werkzeug.security.generate_password_hash`（scrypt方式）
   - Node.js: `bcryptjs`（bcrypt方式、ソルトラウンド10）

2. **入力検証**
   - メールアドレス形式チェック（正規表現）
   - パスワード最小長（6文字以上）
   - パスワード確認一致チェック
   - ユーザー名・メール重複チェック

3. **SQLインジェクション対策**
   - Flask: SQLAlchemy ORMによるパラメータ化
   - Node.js: パラメータ化クエリ

---

## 📦 repository-B: FastAPI サーバー

### 機能概要
文字列操作と数値計算を提供するシンプルなユーティリティAPIサーバー。

### 実装方式
- **言語**: Python 3.x
- **フレームワーク**: FastAPI 0.115.6
- **ポート**: （デフォルト8000）

### API仕様

#### 1. Hello World
- **エンドポイント**: `GET /hello`
- **説明**: "HELLO"メッセージを返す
- **レスポンス**:
  ```json
  {
    "message": "HELLO"
  }
  ```

#### 2. 数値加算
- **エンドポイント**: `POST /add`
- **説明**: 2つの整数の合計を返す
- **リクエストボディ**:
  ```json
  {
    "a": 5,
    "b": 3
  }
  ```
- **レスポンス**:
  ```json
  {
    "result": 8
  }
  ```

#### 3. 文字列反転
- **エンドポイント**: `POST /reverse`
- **説明**: 文字列を逆順にして返す
- **リクエストボディ**:
  ```json
  {
    "text": "hello"
  }
  ```
- **レスポンス**:
  ```json
  {
    "reversed": "olleh"
  }
  ```

#### 4. 文字列長
- **エンドポイント**: `POST /length`
- **説明**: 文字列の長さを返す
- **リクエストボディ**:
  ```json
  {
    "text": "FastAPI"
  }
  ```
- **レスポンス**:
  ```json
  {
    "length": 7
  }
  ```

#### 5. 文字列を大文字に変換
- **エンドポイント**: `POST /upper`
- **説明**: 文字列を大文字に変換して返す
- **リクエストボディ**:
  ```json
  {
    "text": "hello"
  }
  ```
- **レスポンス**:
  ```json
  {
    "upper": "HELLO"
  }
  ```

#### 6. リストの合計値
- **エンドポイント**: `POST /sum-list`
- **説明**: 整数のリストを受け取り、その合計値を返す
- **リクエストボディ**:
  ```json
  {
    "numbers": [1, 2, 3, 4, 5]
  }
  ```
- **レスポンス**:
  ```json
  {
    "sum": 15
  }
  ```

#### 7. 文字列連結
- **エンドポイント**: `POST /concat`
- **説明**: 2つの文字列を連結して返す
- **リクエストボディ**:
  ```json
  {
    "a": "Hello",
    "b": "World"
  }
  ```
- **レスポンス**:
  ```json
  {
    "concat": "HelloWorld"
  }
  ```

---

## 🔄 更新履歴

| 日付 | 変更内容 | AIモデル名 |
|------|---------|-----------|
| 2026-02-13 | 初版作成 | Claude Sonnet 4.5 |
| 2026-02-13 | repository-AにGET /api/usersエンドポイント追加、repository-Bに3つの新規エンドポイント追加（/upper, /sum-list, /concat） | Claude Sonnet 4.5 |

---

## 📝 運用ルール

このドキュメントは、サブモジュールの変更に応じてGitHub Actions + GitHub Copilotにより自動更新されます。  
手動編集は避け、変更が必要な場合はサブモジュール側のソースコードまたはコメントを修正してください。

---

**最終更新日時（日本時間）**: 2026年2月13日 10:58:46

